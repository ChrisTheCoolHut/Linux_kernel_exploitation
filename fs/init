#!/bin/sh

mount -t proc none /proc
mount -t sysfs none /sys
mount -t 9p -o trans=virtio,version=9p2000.L,nosuid hostshare /home/ctf
#for f in $(ls *.ko); do
#    insmod $f
#done
insmod /kern_modules/kernel-overflow.ko
mknod /dev/kernel-overflow c 248 0
chmod 666 /dev/kernel-overflow
insmod /kern_modules/kernel-leak.ko
mknod /dev/kernel-leak c 247 0
chmod 666 /dev/kernel-leak

# for ptmx leak
mknod /dev/ptmx c 5 2
mkdir /dev/pts
mount none -t devpts /dev/pts

sysctl -w kernel.perf_event_paranoid=1

cat <<EOF


Boot took $(cut -d' ' -f1 /proc/uptime) seconds


Welcome to pwn.college


EOF
chmod 600 /flag
chown 0.0 /flag
/bin/sh
#exec su -l ctf
